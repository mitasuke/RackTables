ファイルダウンロード・展開

$ wget --no-check-certificate https://downloads.sourceforge.net/project/racktables/RackTables-0.20.14.tar.gz

$ tar zxpvf RackTables-0.20.14.tar.gz
# mv RackTables-0.20.14/wwwroot /www/rack/htdocs/racktables


MySQLにデータベースとユーザを作成

$ /usr/local/mysql/bin/mysql -uroot -p

mysql> create database racktables;
mysql> show databases;

mysql> create user rack identified by 'パスワード';
mysql> create user rack@localhost identified by 'パスワード';
mysql> select user,host from mysql.user;

権限の設定と確認

mysql> grant all on racktables.* to root identified by 'パスワード';
mysql> grant all on racktables.* to root@localhost identified by 'パスワード';
mysql> grant all on racktables.* to rack identified by 'パスワード';
mysql> grant all on racktables.* to rack@localhost identified by 'パスワード';

mysql> show grants for root;
+------------------------------------------------------+
| Grants for root@%                                    |
+------------------------------------------------------+
| GRANT USAGE ON *.* TO 'root'@'%'                     |
| GRANT ALL PRIVILEGES ON `racktables`.* TO 'root'@'%' |
+------------------------------------------------------+

mysql> show grants for 'root'@'localhost';
+---------------------------------------------------------------------+
| Grants for root@localhost                                           |
+---------------------------------------------------------------------+
| GRANT ALL PRIVILEGES ON *.* TO 'root'@'localhost' WITH GRANT OPTION |
| GRANT ALL PRIVILEGES ON `racktables`.* TO 'root'@'localhost'        |
| GRANT PROXY ON ''@'' TO 'root'@'localhost' WITH GRANT OPTION        |
+---------------------------------------------------------------------+

mysql> show grants for 'rack';
+------------------------------------------------------+
| Grants for rack@%                                    |
+------------------------------------------------------+
| GRANT USAGE ON *.* TO 'rack'@'%'                     |
| GRANT ALL PRIVILEGES ON `racktables`.* TO 'rack'@'%' |
+------------------------------------------------------+

mysql> show grants for 'rack'@'localhost';
+--------------------------------------------------------------+
| Grants for rack@localhost                                    |
+--------------------------------------------------------------+
| GRANT USAGE ON *.* TO 'rack'@'localhost'                     |
| GRANT ALL PRIVILEGES ON `racktables`.* TO 'rack'@'localhost' |
+--------------------------------------------------------------+

ログイン確認

$ /usr/local/mysql/bin/mysql -urack -p



アクセスする前にSSLを有効化

# vi /usr/local/httpd/conf/vsite/rack.conf
　→SSL関連の設定からコメントアウト外す

# cd /www/rack/conf/
# mkdir key
# chmod 400 key
　→あとは普通に証明書・鍵を設置して反映する


アクセス

https://rack/racktables

--------------------------------------------------------------------------------------------------
Configuration error


This instance of RackTables misses a configuration file (/var/www/html/racktables/inc/secret.php).
The configuration file is usually generated by RackTables installer, which can be launched here.
--------------------------------------------------------------------------------------------------
　→こんなメッセージが出るので、リンクになっている here の部分をクリックする。

RackTables installation: step 1 of 7 のページに飛ぶ。
「proceed」ボタンをクリックする。

--------------------------------------------------------------------------------------------------
RackTables installation: step 2 of 7

PHP version >= 5.2.10	PASSED
PDO extension	PASSED
PDO-MySQL extension	PASSED
PCRE extension	PASSED
PCRE compiled with
--enable-unicode-properties	PASSED
SNMP extension	NOT PRESENT
GD extension	PASSED
Multibyte string extension	PASSED
LDAP extension	NOT PRESENT
PCNTL extension	NOT PRESENT
JSON extension	PASSED
cURL extension	PASSED
BC Math extension	PASSED
accessed over HTTPS	PASSED
--------------------------------------------------------------------------------------------------
　→「proceed」ボタンをクリックする。

--------------------------------------------------------------------------------------------------
RackTables installation: step 3 of 7

The /data/www/rack/htdocs/racktables/inc/secret.php file is not writable by web-server. Make sure it is.The following commands should suffice:
touch '/data/www/rack/htdocs/racktables/inc/secret.php'; chmod a=rw '/data/www/rack/htdocs/racktables/inc/secret.php'
Fedora Linux with SELinux may require this file to be owned by specific user (apache) and/or executing "setenforce 0" for the time of installation. SELinux may be turned back on with "setenforce 1" command.
--------------------------------------------------------------------------------------------------

↑のメッセージに従ってコマンドを実行してみる。

# touch /data/www/rack/htdocs/racktables/inc/secret.php
# chmod a=rw /data/www/rack/htdocs/racktables/inc/secret.php

「retry」ボタンをクリックする。


--------------------------------------------------------------------------------------------------
RackTables installation: step 3 of 7

Server-side MySQL setup of the database:

mysql>
CREATE DATABASE racktables_db CHARACTER SET utf8 COLLATE utf8_general_ci;
CREATE USER racktables_user@localhost IDENTIFIED BY 'MY_SECRET_PASSWORD';
GRANT ALL PRIVILEGES ON racktables_db.* TO racktables_user@localhost;

TCP connection	
UNIX socket	
TCP host:	
localhost
TCP port (if not 3306):	
UNIX socket:	
/var/lib/mysql/mysql.sock
database:	
racktables_db
username:	
racktables_user
password:	
--------------------------------------------------------------------------------------------------
　→DB接続設定を入力して「retry」ボタンをクリックする。入力内容は以下。

「TCP connection」：チェックつける
「TCP host」：localhost
「TCP port (if not 3306)」：空白（デフォルトの3306ポートを使用）
「UNIX socket」：/tmp/mysql.sock
「database」：racktables
「username」：rack
「password」：パスワード（rackユーザに設定したパスワード）

「The configuration file has been written successfully.」が表示されたら、
「proceed」ボタンをクリックする。

--------------------------------------------------------------------------------------------------
RackTables installation: step 4 of 7

Please set ownership (chown) and/or permissions (chmod) of /data/www/rack/htdocs/racktables/inc/secret.php on the server filesystem as follows:
The file MUST NOT be writable by the httpd process.
The file MUST be readable by the httpd process.
The file should not be readable by anyone except the httpd process.
The file should not be writable by anyone.
For example, if httpd runs as user "www" and group "nogroup", commands similar to the following may work (though not guaranteed to, please consider only as an example):
chown www:nogroup secret.php; chmod 400 secret.php
--------------------------------------------------------------------------------------------------

Apacheの実行ユーザ・グループに secret.php に対する読み取り権限だけ与えろ
ということだと思う。

# chown www:www /www/rack/htdocs/racktables/inc/secret.php
# chmod 400 /www/rack/htdocs/racktables/inc/secret.php

「retry」ボタンをクリックする。

The configuration file ownership/permissions seem to be OK.
と表示されたら「proceed」ボタンをクリックする。


エラー画面？
======================================================
PDOException
SQLSTATE[HY000]: General error: 1419 You do not have the SUPER privilege and binary logging is enabled (you *might* want to use the less safe log_bin_trust_function_creators variable) (HY000)
at file /data/www/rack/htdocs/racktables/inc/dictionary.php, line 43

/data/www/rack/htdocs/racktables/inc/dictionary.php:43 query('CREATE TRIGGER `trigger_test` BEFORE INSERT ON `innodb_test` FOR EACH ROW BEGIN END')
/data/www/rack/htdocs/racktables/inc/install.php:365 isInnoDBSupported()
/data/www/rack/htdocs/racktables/inc/install.php:66 init_database_static()
/data/www/rack/htdocs/racktables/index.php:293 renderInstallerHTML()
Error info:
Array
(
    [0] => HY000
    [1] => 1419
    [2] => You do not have the SUPER privilege and binary logging is enabled (you *might* want to use the less safe log_bin_trust_function_creators variable)
)
Parameters:
GET
module	installer
POST
step	5
COOKIE
======================================================

トリガーを作ろうとして失敗している？


MySQLに接続して設定値を確認・有効化

mysql> show variables like 'log_bin_trust_function_creators';
+---------------------------------+-------+
| Variable_name                   | Value |
+---------------------------------+-------+
| log_bin_trust_function_creators | OFF   |
+---------------------------------+-------+

mysql> set global log_bin_trust_function_creators = 1;

mysql> show variables like 'log_bin_trust_function_creators';
+---------------------------------+-------+
| Variable_name                   | Value |
+---------------------------------+-------+
| log_bin_trust_function_creators | ON    |
+---------------------------------+-------+

ここでエラー画面を F5 でリロードしたら、
RackTables installation: step 5 of 7 の画面が表示される。
データベースの初期化がされてる模様。
「errors」の欄が 0 なので問題無し・・・と信じる。

my.cnfに以下を追記しておく。
------------------------------------
log_bin_trust_function_creators = 1
------------------------------------

「proceed」を押して進む。

----------------------------------------
RackTables installation: step 6 of 7

Administrator password not set
----------------------------------------
　→管理者パスワードを設定するよう要求されるので設定する（パスワード）

Administrator password has been set successfully.
が表示されたら「proceed」をクリック。

----------------------------------------
Congratulations! RackTables installation is complete. After pressing Proceed you will enter the system. Authenticate with admin username.
RackTables project has a wiki and a mailing list for users. Have fun.
----------------------------------------
　→インストールが完了したようなので、「proceed」をクリックしておわり。

アカウントとパスワード入力を要求される。
admin / パスワード

　→ログインできた！



操作する前に、初期状態でDBバックアップを取得しておく。

# cd /data/mysql/backup
# /usr/local/mysql/bin/mysqldump --single-transaction --create-options --add-drop-table --all-databases --events --force -u root -p > first_db.dmp
